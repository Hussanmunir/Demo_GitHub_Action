
# ============================================
# CI/CD Pipeline (Single Workflow)
# - CI: Run tests on pull requests to main
# - CD: After merge to main, print "Ready for deployment" message
# ============================================

name: CI/CD Pipeline (PR Tests + Deployment Message)

# Trigger workflow on:
# - Pull requests targeting main (CI phase)
# - Pushes to main (post-merge, CD phase)
on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

jobs:
  # --------------------------------------------
  # Job 1 — CI on Pull Requests
  # Purpose: Validate code BEFORE merging into main
  # --------------------------------------------
  pr-tests:
    if: ${{ github.event_name == 'pull_request' }}  # Run only for PR events
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'  # Use latest Python 3.x version

      # Step 3: Install dependencies (skip requirements.txt as requested)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest

      # Step 4: Run tests using pytest
      - name: Run tests
        run: pytest -v  # Verbose output for clarity in logs

      # Step 5: Print success message if tests pass
      - name: CI Passed — Ready for manual merge
        if: success()
        run: echo "✅ Tests passed on PR. Ready for manual review and merge."

  # --------------------------------------------
  # Job 2 — Deployment Message After Merge
  # Purpose: Signal readiness AFTER merge completes
  # --------------------------------------------
  deploy-message:
    # Run only when code is pushed to main (after merge)
    if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
    runs-on: ubuntu-latest

    steps:
      # Step 1: Print deployment-ready message
      - name: Ready for Deployment
        run: echo "✅ Code merged into main. Ready for deployment"
